# מדריך ייבוא CSV מקוויק שופ הישן

## ✅ מה שופר

הייבוא מ-CSV שופר כדי לתמוך בפורמט של קוויק שופ הישן:

### תמיכה בעברית
- ✅ תמיכה בעמודות בעברית (שם מוצר, מחיר רגיל, מקט, וכו')
- ✅ תמיכה גם באנגלית (name, price, sku, וכו')

### שדות נתמכים
- ✅ שם מוצר / name
- ✅ סלאג / slug
- ✅ תיאור / description
- ✅ מחיר רגיל / price / regular_price
- ✅ מחיר מבצע / sale_price / compare_at_price
- ✅ מקט / sku
- ✅ כמות במלאי / inventory_quantity
- ✅ התעלם ממלאי / ignore_inventory
- ✅ מוסתר / hidden
- ✅ קטגוריות / categories
- ✅ תגים / tags
- ✅ סוג מוצר / product_type
- ✅ תמונה ראשית / image / product_image

### תכונות
- ✅ יוצר variant ברירת מחדל עם "Default Title"
- ✅ שומר מחיר רגיל ומחיר מבצע ב-variant
- ✅ שומר SKU ומלאי ב-variant
- ✅ מטפל במוצרים מוסתרים (מעביר ל-draft)
- ✅ מטפל ב-"התעלם ממלאי" (מגדיר inventory_policy = 'continue')
- ✅ **העברת תמונות מ-S3 ל-Cloudinary:**
  - מוריד תמונות מהשרת הישן (S3)
  - ממיר ל-WebP אם התמונה לא WebP (אופטימיזציה)
  - מעלה ל-Cloudinary עם אופטימיזציה אוטומטית
  - שומר ב-`media_files` (כאילו הועלה ידנית דרך הדשבורד)
  - שומר ב-`product_images` (קישור למוצר)

## ✅ תמיכה מלאה בפורמט הישן

הייבוא תומך **בדיוק** באותן עמודות של קוויק שופ הישן:

```
ID,"שם מוצר",סלאג,תיאור,"מחיר רגיל","מחיר מבצע",מקט,"כמות במלאי","התעלם ממלאי",מוסתר,קטגוריות,תגים,"סוג מוצר","תמונה ראשית","תאריך יצירה"
```

כל העמודות נתמכות:
- ✅ ID - מזהה המוצר הישן (לא נשמר, רק לזיהוי)
- ✅ שם מוצר - שם המוצר
- ✅ סלאג - סלאג המוצר
- ✅ תיאור - תיאור המוצר
- ✅ מחיר רגיל - מחיר רגיל
- ✅ מחיר מבצע - מחיר מבצע
- ✅ מקט - SKU
- ✅ כמות במלאי - כמות במלאי
- ✅ התעלם ממלאי - התעלם ממלאי (כן/לא)
- ✅ מוסתר - מוצר מוסתר (כן/לא)
- ✅ קטגוריות - קטגוריות (מופרדות בפסיק)
- ✅ תגים - תגים (מופרדים בפסיק)
- ✅ סוג מוצר - סוג מוצר
- ✅ תמונה ראשית - שם קובץ התמונה
- ✅ תאריך יצירה - תאריך יצירה (לא נשמר, רק לזיהוי)

## 🚀 איך להתחיל?

### שלב 1: הכנות

1. **ייצא CSV** מהמערכת הישנה
2. **הגדר משתני סביבה** ב-`.env`:
   ```env
   # Cloudinary (חובה)
   CLOUDINARY_URL=cloudinary://...
   
   # S3 (אופציונלי - לניסיון אוטומטי למצוא תמונות)
   OLD_S3_BASE_URL=https://s3.amazonaws.com/bucket-name
   ```

### שלב 2: ייבוא

#### דרך הדשבורד (מומלץ):
1. לך ל-**Products** → **Import**
2. בחר את קובץ ה-CSV (בדיוק כמו שייצאת מהמערכת הישנה)
3. **💡 מומלץ לבדיקה:** סמן "מצב בדיקה" והגבל ל-3 מוצרים
4. לחץ על **Import**
5. **זה הכל!** - הקוד מזהה אוטומטית את כל העמודות

**מצב בדיקה:**
- ✅ אפשרות לייבא רק מספר מוצרים מוגבל (ברירת מחדל: 3)
- ✅ מושלם לבדיקה לפני ייבוא מלא
- ✅ חוסך זמן ומאפשר לבדוק שהכל עובד נכון

#### דרך API:
```bash
curl -X POST https://your-domain.com/api/products/import \
  -H "Authorization: Bearer YOUR_TOKEN" \
  -F "file=@products_export_argania_2025-12-27_19-50-28.csv"
```

### שלב 3: בדיקה

- ✅ בדוק שהמוצרים נוצרו
- ✅ בדוק שהמחירים נכונים
- ✅ בדוק שהתמונות עלו
- ✅ בדוק שהקטגוריות והתגים נוצרו

**ראה `MIGRATION_STEPS.md` למדריך מפורט!**

### דרך API
```bash
curl -X POST https://your-domain.com/api/products/import \
  -H "Authorization: Bearer YOUR_TOKEN" \
  -F "file=@products_export_argania_2025-12-27_19-50-28.csv"
```

## הגדרת תמונות

כדי שהתמונות יעברו מ-S3 ל-Cloudinary, צריך להגדיר ב-`.env`:

```env
# אפשרות 1: URL בסיס
OLD_S3_BASE_URL=https://s3.amazonaws.com/bucket-name

# אפשרות 2: פרטים נפרדים
OLD_S3_BUCKET=bucket-name
OLD_S3_REGION=us-east-1
```

הכלי ינסה אוטומטית מספר פורמטים של URLs:
- `https://bucket.s3.region.amazonaws.com/store_id/filename`
- `https://bucket.s3.region.amazonaws.com/filename`
- `https://s3.region.amazonaws.com/bucket/store_id/filename`
- `https://s3.amazonaws.com/bucket/store_id/filename`

## מה לא נתמך

- ❌ וריאציות - הקובץ CSV לא כולל וריאציות, רק מוצרים רגילים
- ❌ אפשרויות - לא ניתן לייבא אפשרויות מ-CSV
- ❌ גלריית תמונות - רק תמונה ראשית נתמכת

למוצרים עם וריאציות, צריך להשתמש בכלי ההעברה המלא (`scripts/migrate-from-old-quickshop.ts`).

## דוגמה לקובץ CSV

```csv
ID,"שם מוצר",סלאג,תיאור,"מחיר רגיל","מחיר מבצע",מקט,"כמות במלאי","התעלם ממלאי",מוסתר,קטגוריות,תגים,"סוג מוצר","תמונה ראשית","תאריך יצירה"
21235,"מסיכה לשיער ארגן (500 מ""ל)","מסיכה-לשיער-ארגן","תיאור המוצר...",50.90,0.00,7290016299892,0,לא,לא,"מסכה, סדרת ארגן",,רגיל,69030752a72e6.webp,"2025-10-08 16:03:04"
```

## הערות

1. **תמונות:** אם תמונה לא נמצאה ב-S3, המוצר ייווצר בלי תמונה (לא ייכשל)
2. **מחירים:** אם מחיר מבצע = 0 או ריק, הוא לא יישמר
3. **מלאי:** אם לא מוגדר, יוגדר ל-0
4. **סטטוס:** מוצרים מוסתרים יועברו ל-draft, אחרת ל-active

