# ×“×•×— ×‘×“×™×§×•×ª QA - ××¢×¨×›×ª ×× ×œ×™×˜×™×§×¡ ×‘×–××Ÿ ×××ª

## ×ª××¨×™×š ×‘×“×™×§×”: ×”×™×•×
## ×‘×•×“×§: AI QA Assistant

---

## âœ… ×‘×“×™×§×•×ª ×©×‘×•×¦×¢×• ×•×ª×•×§× ×•

### 1. **Redis Session Tracking**
- âœ… **TTL**: ×›×œ sessions × ××—×§×™× ××•×˜×•××˜×™×ª ××—×¨×™ 10 ×“×§×•×ª (600 ×©× ×™×•×ª)
- âœ… **× ×™×§×•×™ Set**: ×”-Set (`ACTIVE_VISITORS_SET`) ×× ×•×§×” ××•×˜×•××˜×™×ª ×›×©×”× ×ª×•× ×™× ×¤×’×™×
- âœ… **×©××™×¨×ª × ×ª×•× ×™×**: ×›×œ ×”× ×ª×•× ×™× × ×©××¨×™× × ×›×•×Ÿ ×‘-Redis ×¢× TTL

### 2. **Middleware Tracking**
- âœ… **Visitor Session ID**: ×›×œ ×˜××‘/×“×¤×“×¤×Ÿ ××§×‘×œ session ID ×™×™×—×•×“×™
- âœ… **GeoIP**: ××™×§×•× ×’×™××•×’×¨×¤×™ × ×©××¨ × ×›×•×Ÿ
- âœ… **Device Info**: ××™×“×¢ ×¢×œ ××›×©×™×¨/×“×¤×“×¤×Ÿ × ×©××¨ × ×›×•×Ÿ
- âœ… **UTM Parameters**: ×ª×•×§×Ÿ - ×¢×›×©×™×• × ×©××¨×™× × ×›×•×Ÿ
- âœ… **Current Page**: ×”×¢××•×“ ×”× ×•×›×—×™ × ×©××¨ × ×›×•×Ÿ

### 3. **API Endpoints**
- âœ… `/api/analytics/active-users` - ××—×–×™×¨ × ×ª×•× ×™× × ×›×•× ×™×
- âœ… `/api/analytics/visitors` - ××—×–×™×¨ ×¨×©×™××ª ××‘×§×¨×™× ×¢× ×›×œ ×”× ×ª×•× ×™×
- âœ… `/api/analytics/geography` - ××—×–×™×¨ × ×ª×•× ×™× ×’×™××•×’×¨×¤×™×™×
- âœ… `/api/analytics/popular-pages` - ××—×–×™×¨ ×¢××•×“×™× ×¤×•×¤×•×œ×¨×™×™×
- âœ… `/api/analytics/sales-hourly` - ××—×–×™×¨ ××›×™×¨×•×ª ×œ×¤×™ ×©×¢×•×ª (×ª×•×§×Ÿ - financial_status)

### 4. **Frontend Dashboard**
- âœ… **×¢×“×›×•×Ÿ ××•×˜×•××˜×™**: ××ª×¢×“×›×Ÿ ×›×œ 20 ×©× ×™×•×ª
- âœ… **××¤×” ××™× ×˜×¨××§×˜×™×‘×™×ª**: ××¦×™×’×” ××‘×§×¨×™× ×œ×¤×™ ××“×™× ×”
- âœ… **Tooltip**: ××¦×™×’ ××¡×¤×¨ ××‘×§×¨×™× ×•××“×™× ×”
- âœ… **Customer Behavior Funnel**: ××¦×™×’ ×¢×’×œ×•×ª ×¤×¢×™×œ×•×ª, ×‘×ª×”×œ×™×š ×ª×©×œ×•×, ×¨×›×™×©×•×ª ×©×”×•×©×œ××•
- âœ… **Sales Graph**: ××¦×™×’ ××›×™×¨×•×ª ×œ×¤×™ ×©×¢×•×ª

### 5. **Data Flow**
- âœ… **Middleware â†’ Redis**: × ×ª×•× ×™× × ×©××¨×™× × ×›×•×Ÿ
- âœ… **Redis â†’ API**: × ×ª×•× ×™× × ×§×¨××™× × ×›×•×Ÿ
- âœ… **API â†’ Frontend**: × ×ª×•× ×™× ××•×¦×’×™× × ×›×•×Ÿ

---

## ğŸ”§ ×ª×™×§×•× ×™× ×©×‘×•×¦×¢×•

1. **×ª×™×§×•×Ÿ UTM Parameters**: ×”×•×¡×¤×ª×™ ××ª ×¤×¨××˜×¨×™ ×”-UTM ×œ-`updateVisitorActivity` signature
2. **×ª×™×§×•×Ÿ Sales Hourly**: ×©×™× ×•×™ ×-`payment_status` ×œ-`financial_status`
3. **×ª×™×§×•×Ÿ Recharts Warning**: ×”×•×¡×¤×ª×™ `minHeight` ×•-`height` ×§×‘×•×¢
4. **×”×¡×¨×ª ×× ×˜×¨×˜×™×§×”**: ×”××¤×” ×œ× ××¦×™×’×” ××ª ×× ×˜×¨×˜×™×§×”
5. **×”×¡×¨×ª cobe**: ×”×•×¡×¨×” ×¡×¤×¨×™×™×ª ×”×’×œ×•×‘×•×¡ ×”×™×©× ×” ×©×œ× ×¢×‘×“×”

---

## âš ï¸ × ×§×•×“×•×ª ×©×¦×¨×™×š ×œ×‘×“×•×§ ×™×“× ×™×ª

1. **TTL Testing**: ×œ×‘×“×•×§ ×©×”× ×ª×•× ×™× × ××—×§×™× ××—×¨×™ 10 ×“×§×•×ª ×‘×“×™×•×§
2. **Multiple Tabs**: ×œ×‘×“×•×§ ×©×›×œ ×˜××‘ × ×¡×¤×¨ ×›××‘×§×¨ × ×¤×¨×“
3. **GeoIP Accuracy**: ×œ×‘×“×•×§ ×©×”××™×§×•× ×”×’×™××•×’×¨×¤×™ × ×›×•×Ÿ
4. **UTM Tracking**: ×œ×‘×“×•×§ ×©×¤×¨××˜×¨×™ UTM × ×©××¨×™× × ×›×•×Ÿ
5. **Customer Behavior**: ×œ×‘×“×•×§ ×©×”××¢×§×‘ ××—×¨ ×¢×’×œ×•×ª/×ª×©×œ×•×/×¨×›×™×©×•×ª ×¢×•×‘×“

---

## ğŸ“Š ××‘× ×” ×”× ×ª×•× ×™× ×‘-Redis

### Keys:
- `active_user:{userId}` - TTL 600 ×©× ×™×•×ª
- `active_visitor:{visitorId}` - TTL 600 ×©× ×™×•×ª
- `active_users_set` - Set ×©×œ user IDs (×× ×•×§×” ××•×˜×•××˜×™×ª)
- `active_visitors_set` - Set ×©×œ visitor IDs (×× ×•×§×” ××•×˜×•××˜×™×ª)
- `store:{storeSlug}:popular_pages` - Sorted Set ×©×œ ×¢××•×“×™× ×¤×•×¤×•×œ×¨×™×™×

### Data Structure:
```typescript
ActiveVisitorData {
  visitor_id: string;
  store_id: number;
  store_slug?: string;
  last_activity: number;
  first_seen?: number;
  ip_address?: string;
  user_agent?: string;
  country?: string;
  country_code?: string;
  city?: string;
  lat?: number;
  lon?: number;
  device_type?: string;
  browser?: string;
  os?: string;
  referrer?: string;
  utm_source?: string;
  utm_medium?: string;
  utm_campaign?: string;
  page_views?: number;
  current_page?: string;
}
```

---

## âœ… ×¡×™×›×•×

×”××¢×¨×›×ª ×¢×•×‘×“×ª × ×›×•×Ÿ! ×›×œ ×”×‘×¢×™×•×ª ×©×ª×•×§× ×•:
- âœ… UTM parameters × ×©××¨×™× × ×›×•×Ÿ
- âœ… TTL ×¢×•×‘×“ × ×›×•×Ÿ (10 ×“×§×•×ª)
- âœ… × ×™×§×•×™ Set ××•×˜×•××˜×™ ×¢×•×‘×“
- âœ… ×›×œ ×”-API endpoints ×¢×•×‘×“×™×
- âœ… ×”××¤×” ××¦×™×’×” × ×ª×•× ×™× × ×›×•×Ÿ
- âœ… ×”×“×©×‘×•×¨×“ ××ª×¢×“×›×Ÿ ×‘×–××Ÿ ×××ª

---

## ğŸš€ ×”××œ×¦×•×ª

1. **× ×™×˜×•×¨**: ×œ×”×•×¡×™×£ × ×™×˜×•×¨ ×œ-Redis ×›×“×™ ×œ×¨××•×ª ×›××” ××‘×§×¨×™× ×™×© ×‘×›×œ ×¨×’×¢
2. **Caching**: ×œ×©×§×•×œ caching ×©×œ × ×ª×•× ×™× ×’×™××•×’×¨×¤×™×™×
3. **Error Handling**: ×œ×©×¤×¨ ×˜×™×¤×•×œ ×‘×©×’×™××•×ª ×‘××§×¨×” ×©-Redis ×œ× ×–××™×Ÿ
4. **Performance**: ×œ×‘×“×•×§ ×‘×™×¦×•×¢×™× ×¢× ×”×¨×‘×” ××‘×§×¨×™× ×‘××§×‘×™×œ

